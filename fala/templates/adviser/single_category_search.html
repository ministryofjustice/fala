{% extends 'adviser/adviser_base.html' %}

{% block pageTitle %}
  {% if results %}
    Search results
  {% else %}
    Find a Legal Aid Adviser or Family Mediator
  {% endif %}
{% endblock %}

{% import "macros/element.html" as Element %}
{% import "macros/forms.html" as Form %}

{%- from 'govuk_frontend_jinja/components/error-summary/macro.html' import govukErrorSummary %}
{%- from 'govuk_frontend_jinja/components/checkboxes/macro.html' import govukCheckboxes %}
{%- from "govuk_frontend_jinja/components/input/macro.html" import govukInput %}

{% block content %}
  {% if results %}
    <!-- Content for search results -->
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-xl">You closest legal aid advisors for  {{ category_display_name }}</h1>
      {% if results.count >= 1 %}
        <p class="govuk-body">You can contact any legal adviser on the list but you might need to contact a few to find one near you that can help. Those based further away may be able to help by telephone.</p>
        <p class="govuk-body">These advisers are contracted by the government and regulated by the Solicitors Regulation Authority.</p>
        <ul class="govuk-list results-list">
          {% for item in results.results %}
            <li class="results-list-item govuk-!-margin-bottom-6">
              {% if item.distance %}
                <p class="govuk-body-s govuk-!-margin-top-0">
                  <span class="govuk-visually-hidden">{{ _('Distance') }}</span>
                  {% trans miles=item.distance|round(1) %}{{ miles }} miles away{% endtrans %}
                </p>
              {% endif %}
              <div class="telephone">
                <span class="tel">{{ item.telephone }}</span>
              </div>
              <div class="address">
                <span class="govuk-visually-hidden">{{ _('Address') }}:</span>
                  <span class="notranslate" translate="no">{{ item.location.address.replace('\n', ', ') }},</span>
                  <span class="notranslate" translate="no">{{ item.location.city }},</span>
                  <span class="notranslate" translate="no">{{ item.location.postcode }}</span>
              </div>
              <a class="govuk-link govuk-!-display-none-print" class="url" target="_blank" rel="noopener" href="https://www.google.com/maps/search/?{{ item|google_map_params|urlencode }}">
                View on map (opens in new tab)
              </a>
              {% if item.categories|length %}
              <div class="categories">
                <h3 class="govuk-heading-s govuk-!-margin-top-4 govuk-!-margin-bottom-0">{{ _('Can help with') }}</h3>
                <ul class="govuk-list govuk-list--bullet govuk-!-margin-top-0 govuk-!-margin-bottom-3">
                  {% for cat in item.categories|sort %}
                    <li>
                      {% if cat == "Housing Loss Prevention Advice Service" %}
                        {{ cat }}
                      {% else %}
                       {{ cat|lower }}
                      {% endif %}
                    </li>
                  {% endfor %}
                </ul>
              </div>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <h1 class="govuk-heading-xl govuk-!-margin-bottom-5">No search results</h1>
        <p class="govuk-body-m" id="no-results-info">There are no results for your criteria.</p>
      {% endif %}
    </div>
  {% else %}
    <!-- Content for search form -->
    <div class="govuk-grid-column-two-thirds">
      <div id="google_translate_element" class="govuk-!-margin-bottom-6"></div>
      {% if form.errors %}
        {{ govukErrorSummary({
          "titleText": "There is a problem",
          "errorList": errorList
        }) }}
      {% endif %}
      <h1 class="govuk-heading-xl"> Find a legal aid adviser for 
        {% if category_slug == 'hlpas' %}
          {{ category_display_name }}
        {% else %}
          {{ category_display_name | lower }}
        {% endif %}
      </h1>
      <p class="govuk-body">Search for official legal aid advisers in England and Wales.</p>
      {% if category_message %}
        <p class="govuk-body">{{ category_message | linebreaks }}</p>
      {% endif %}
    </div>

    {% block search_form %}
      <div class="govuk-grid-column-two-thirds">
        <form action="{{ search_url }}" method="get" id="fala_questions">
          <input type="hidden" name="category" value="{{ category_code }}">
          {% if 'postcode' in form.errors or form.errors['__all__'] %}
            {{ govukInput({
              'label': {'text': "What is your postcode?", 'classes': 'govuk-label--s'},
              'value': form.postcode.value(),
              'errorMessage': {'text': form.errors['postcode'][0]},
              'hint': {'text': "For example, SW1H 9AJ"},
              'attributes': {'maxLength': 30},
              'id': 'id_postcode',
              'classes': 'govuk-input--width-10',
              'name': "postcode"
            }) }}
          {% else %}
            {{ govukInput({
              'label': {'text': "What is your postcode?", 'classes': 'govuk-label--s'},
              'value': form.postcode.value(),
              'hint': {'text': "For example, SW1H 9AJ"},
              'attributes': {'maxLength': 30},
              'id': 'id_postcode',
              'classes': 'govuk-input--width-10',
              'name': "postcode"
            }) }}
          {% endif %}
          {{ govukButton({'text': "Search", 'type': "submit", 'classes': "govuk-!-margin-bottom-2"}) }}
        </form>
      </div>
    {% endblock %}
  {% endif %}
{% endblock %}
