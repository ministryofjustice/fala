{%- from 'govuk_frontend_jinja/components/header/macro.html' import govukHeader -%}

<!DOCTYPE html>
<html lang="en" class="govuk-template no-js {% block template_type %}{% endblock %}">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>{% block page_title %}GOV.UK - The best place to find government services and information{% endblock %}</title>
    <script nonce="{{request.csp_nonce}}">(function(d){d.className=d.className.replace(/\bno-js\b/,'js-enabled')})(document.documentElement);</script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='shortcut icon' type='image/x-icon' href="{{ static('images/favicon.ico') }}" />
    {% block stylesheets %}{% endblock %}
    {% block head %}{% endblock %}
  </head>
  <body class="govuk-template__body {{ 'fala-' + ENVIRONMENT }} govuk-frontend-supported">
    <a href="#main-content" class="govuk-skip-link">Skip to main content</a>
    <header class="govuk-header " role="banner" data-module="govuk-header">
      <div id="cookie-message" class="laa-cookie-banner
        {% if request.COOKIES.get('cookiePermission') == 'Allowed' %}
          laa-cookies-accepted
        {% elif request.COOKIES.get('cookiePermission') == 'Rejected' %}
          laa-cookies-rejected
        {% endif %}
        " data-module="cookie-banner" role="region" aria-label="cookie banner">
        <div class="govuk-width-container govuk-!-padding-top-3">
          <div class="govuk-grid-row">
            <div class=" govuk-grid-column-three-quarters">
              <div>
                <span class="govuk-heading-m">{% trans %}Cookies on Find a legal adviser or family mediator{% endtrans %}</span>
                <p class="govuk-body">
                  {% set cookie_info_url = '/cookies' %}
                  <p>{% trans %}We use some essential cookies to make this website work.{% endtrans %}</p>
                  <p>{% trans %}Weâ€™d like to set additional cookies so we can remember your settings, understand how people use the service and make improvements.{% endtrans %}</p>
                </p>
              </div>
              <div class="govuk-button-group">
                <button id="cookieAccept" class="govuk-button" type="submit" data-module="track-click" data-accept-cookies="true" data-track-category="cookieBanner" data-track-action="Cookie banner accepted">
                  {% trans %}Accept analytics cookies{% endtrans %}
                </button>
                <button id="cookieReject" class="govuk-button govuk-button--secondary" data-module="track-click" data-accept-cookies="false" data-track-category="cookieBanner" data-track-action="Cookie banner rejected">
                  {% trans %}Reject analytics cookies{% endtrans %}
                </button>
                {% trans %}<a id="cookies_banner_view_link" class="govuk-link" href="/cookies">View cookies</a>{% endtrans %}
              </div>
            </div>
          </div>
        </div>
      </div>

      {% block header %}
        {{ govukHeader({
          'homepageUrl': "https://www.gov.uk/",
          'serviceName': "Find a legal aid adviser or family mediator",
          'serviceUrl': "/"
        }) }}
      {% endblock %}
    </header>

    <div class="govuk-width-container">
      {% block global_subheader %}{% endblock %}
      <main id="main-content" class="govuk-main-wrapper" role="main">
        <div class="govuk-grid-row">
          {% block content %}{% endblock %}
        </div>
      </main>
    </div>

    <footer class="govuk-footer" role="contentinfo">
      {% include "footer.html" %}
    </footer>

    {% block before_main_js %}{% endblock %}
    {% block main_js %}{% endblock %}
    {% block after_main_js %}{% endblock %}
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.5.0.min.js" type="text/javascript"></script>
    <script nonce="{{request.csp_nonce}}">
      function setCookie(key, value, expiry) {
        var expires = new Date();
        expires.setTime(expires.getTime() + (expiry * 24 * 60 * 60 * 1000));
        document.cookie = key + '=' + value + ';expires=' + expires.toUTCString();
      }

      $(function() {
        $("#cookieAccept").click(function() {
          setCookie("cookiePermission", "Allowed", 30);
          $(".laa-cookie-banner").addClass("laa-cookies-accepted");
          tagMan();
        });
        $("#cookieReject").click(function() {
          setCookie("cookiePermission", "Rejected", 30);
          $(".laa-cookie-banner").addClass("laa-cookies-rejected");
        });
      });
      $("#cookie_policy_page_choice").submit(function(e){
        e.preventDefault();
        var value = $("input[name='cookies']:checked").val();
        if (value == "Allowed") {
          setCookie("cookiePermission", "Allowed", 30);
          $(".laa-cookie-banner").addClass("laa-cookies-accepted");
          tagMan();
          location.reload();
        }
        if (value == "Rejected") {
          setCookie("cookiePermission", "Rejected", 30);
          $(".laa-cookie-banner").addClass("laa-cookies-rejected");
          location.reload();
        }
      });
    </script>
  </body>
</html>
